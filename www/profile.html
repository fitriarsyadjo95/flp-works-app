<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0B0B0B" />
    <meta name="description" content="Your personal trading mentor, market toolkit, and daily challenge â€“ all in your pocket." />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>FLP AcademyWorks - Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/trading-platform.js?v=3"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Brand colors from design.json
                        primary: '#FFD60A',
                        success: '#32D74B',
                        warning: '#FFD60A',
                        danger: '#FF453A',
                        info: '#64D2FF',
                        
                        // Background colors
                        bg: '#0B0B0F',
                        'bg-elevated': '#141417',
                        'bg-secondary': '#1C1C1F',
                        'bg-tertiary': '#2C2C2E',
                        
                        // Text colors
                        'label-primary': '#FFFFFF',
                        'label-secondary': 'rgba(235,235,245,0.6)',
                        'label-tertiary': 'rgba(235,235,245,0.3)',
                        'label-quaternary': 'rgba(235,235,245,0.18)',
                        
                        // Fill colors
                        'fill-primary': 'rgba(120,120,128,0.36)',
                        'fill-secondary': 'rgba(120,120,128,0.32)',
                        'fill-tertiary': 'rgba(120,120,128,0.24)',
                        
                        // Interaction colors
                        separator: 'rgba(84,84,88,0.36)',
                        overlay: 'rgba(0,0,0,0.6)',
                        'focus-ring': 'rgba(255,214,10,0.45)',
                        
                        // Trading colors
                        'chart-up': '#32D74B',
                        'chart-down': '#FF453A',
                        buy: '#32D74B',
                        sell: '#FF453A'
                    },
                    fontFamily: {
                        'sf-pro': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-display': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-ui': ['SF Pro Text', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'elevated': '0 4px 16px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)',
                        'card': '0 2px 8px rgba(0,0,0,0.1)',
                        'button': '0 1px 3px rgba(0,0,0,0.12)',
                        'modal': '0 8px 32px rgba(0,0,0,0.24)'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-bg text-label-primary font-sf-ui">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-bg flex items-center justify-center z-50">
        <div class="text-center">
            <div class="text-primary text-2xl font-bold mb-4">FLP</div>
            <div class="text-white">Loading...</div>
        </div>
    </div>
    <!-- Top Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-4 py-3 flex justify-between items-center" style="background: rgba(22,22,24,0.6); backdrop-filter: blur(20px);">
        <div class="text-primary text-base font-sf-display font-semibold">FLP AcademyWorks</div>
        <a href="notifications.html" class="text-label-secondary opacity-80 hover:opacity-100 transition-opacity relative">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                <path d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"></path>
            </svg>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">3</span>
            </div>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="pt-16 pb-20 max-w-md mx-auto">
        <!-- Profile Header -->
        <div class="px-4 mt-6">
            <div class="bg-gray-900 rounded-lg p-6">
                <div class="text-center mb-6">
                    <div id="userAvatar" class="w-24 h-24 bg-primary rounded-full mx-auto mb-4 flex items-center justify-center text-black text-3xl font-bold">
                        JD
                    </div>
                </div>

                <!-- Profile Fields - View Mode -->
                <div id="profileViewMode" class="space-y-4">
                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Full Name</label>
                        <div class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm" id="fullNameDisplay">
                            -
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Username</label>
                        <div class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm" id="usernameDisplay">
                            -
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Email</label>
                        <div class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm" id="emailDisplay">
                            -
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Phone Number</label>
                        <div class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm" id="phoneDisplay">
                            -
                        </div>
                    </div>

                    <button
                        id="editProfileBtn"
                        class="w-full bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors"
                        onclick="toggleEditMode(true)"
                    >
                        Edit Profile
                    </button>
                </div>

                <!-- Profile Fields - Edit Mode (Hidden by default) -->
                <div id="profileEditMode" class="space-y-4 hidden">
                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Full Name</label>
                        <input
                            type="text"
                            id="fullName"
                            class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                            placeholder="Enter your full name"
                        />
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Username</label>
                        <input
                            type="text"
                            id="username"
                            class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                            placeholder="Enter your username"
                        />
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Email</label>
                        <input
                            type="email"
                            id="email"
                            class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                            placeholder="Enter your email"
                        />
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Phone Number</label>
                        <input
                            type="tel"
                            id="phone"
                            class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                            placeholder="Enter your phone number"
                        />
                    </div>

                    <div class="flex gap-3">
                        <button
                            id="cancelEditBtn"
                            class="flex-1 bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors"
                            onclick="toggleEditMode(false)"
                        >
                            Cancel
                        </button>
                        <button
                            id="saveProfileBtn"
                            class="flex-1 bg-primary text-bg font-semibold py-3 rounded-lg hover:bg-primary/90 transition-colors"
                        >
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Change Password Section -->
        <div class="px-4 mt-6">
            <div class="bg-gray-900 rounded-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white">Change Password</h3>
                </div>

                <!-- Password View Mode - Shows button to open change password form -->
                <div id="passwordViewMode">
                    <button
                        id="showPasswordFormBtn"
                        class="w-full bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors"
                        onclick="togglePasswordEditMode(true)"
                    >
                        Change Password
                    </button>
                </div>

                <!-- Password Edit Mode - Hidden by default -->
                <div id="passwordEditMode" class="space-y-4 hidden">
                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Current Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="currentPassword"
                                class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                                placeholder="Enter current password"
                            />
                            <button
                                type="button"
                                onclick="togglePasswordVisibility('currentPassword', this)"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                                    <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">New Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="newPassword"
                                class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                                placeholder="Enter new password"
                            />
                            <button
                                type="button"
                                onclick="togglePasswordVisibility('newPassword', this)"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                                    <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-label-tertiary mt-1">Password must be at least 6 characters</p>
                    </div>

                    <div>
                        <label class="block text-xs text-label-secondary mb-2">Confirm New Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="confirmPassword"
                                class="w-full bg-bg-elevated border border-separator rounded-lg px-4 py-3 text-label-primary text-sm focus:border-primary focus:outline-none"
                                placeholder="Confirm new password"
                            />
                            <button
                                type="button"
                                onclick="togglePasswordVisibility('confirmPassword', this)"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                                    <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button
                            id="cancelPasswordBtn"
                            class="flex-1 bg-gray-700 text-white font-semibold py-3 rounded-lg hover:bg-gray-600 transition-colors"
                            onclick="togglePasswordEditMode(false)"
                        >
                            Cancel
                        </button>
                        <button
                            id="changePasswordBtn"
                            class="flex-1 bg-primary text-bg font-semibold py-3 rounded-lg hover:bg-primary/90 transition-colors"
                        >
                            Save Password
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Items -->
        <div class="px-4 mt-6 space-y-3">
            <!-- Saved Content -->
            <a href="saved-content.html" class="bg-gray-900 rounded-lg p-4 flex items-center justify-between hover:bg-gray-800 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="text-xl">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold">Saved Content</div>
                        <div class="text-gray-400 text-xs">18 items saved</div>
                    </div>
                </div>
                <div class="text-gray-400">â€º</div>
            </a>

            <!-- Referral Link -->
            <a href="referral-program.html" class="bg-gray-900 rounded-lg p-4 flex items-center justify-between hover:bg-gray-800 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="text-xl">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                            <path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold">Referral Program</div>
                        <div class="text-gray-400 text-xs">Earn rewards for invites</div>
                    </div>
                </div>
                <div class="bg-primary text-black px-3 py-1 rounded-full text-xs font-bold">
                    SHARE
                </div>
            </a>

            <!-- Account Settings -->
            <a href="settings.html" class="bg-gray-900 rounded-lg p-4 flex items-center justify-between hover:bg-gray-800 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="text-xl">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                            <path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 000 2l.08.15a2 2 0 010 2l-.08.15a2 2 0 000 2l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 000-2l-.08-.15a2 2 0 010-2l.08-.15a2 2 0 000-2l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold">Account Settings</div>
                        <div class="text-gray-400 text-xs">Notifications, privacy & more</div>
                    </div>
                </div>
                <div class="text-gray-400">â€º</div>
            </a>

            <!-- Help & Support -->
            <a href="help-support.html" class="bg-gray-900 rounded-lg p-4 flex items-center justify-between hover:bg-gray-800 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="text-xl">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                            <path d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold">Help & Support</div>
                        <div class="text-gray-400 text-xs">FAQ, contact us</div>
                    </div>
                </div>
                <div class="text-gray-400">â€º</div>
            </a>

            <!-- Logout -->
            <button type="button" id="logoutButton" class="w-full bg-gray-900 rounded-lg p-4 flex items-center justify-between hover:bg-gray-800 transition-colors active:scale-[0.98]" onclick="if(confirm('Are you sure you want to logout?')){localStorage.clear();window.location.href='login.html';}">
                <div class="flex items-center gap-3">
                    <div class="text-xl">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6 text-danger">
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"></path>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-semibold text-danger text-xs">Logout</div>
                        <div class="text-gray-400 text-xs">Sign out of your account</div>
                    </div>
                </div>
                <div class="text-danger">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                        <path d="M9 18l6-6-6-6"></path>
                    </svg>
                </div>
            </button>
            
            <!-- Simple test logout button (for debugging) -->
            <div class="mt-4 px-4">
                <button onclick="localStorage.clear();alert('Cleared storage');window.location.href='login.html';" class="w-full bg-red-600 text-white py-2 px-4 rounded text-xs">
                    Emergency Logout (Test)
                </button>
            </div>
        </div>
    </main>

    <!-- iOS-style Tab Bar -->
    <nav class="fixed bottom-0 left-0 right-0 z-40 border-t border-separator/50" style="background: rgba(22,22,24,0.75); backdrop-filter: blur(30px);">
        <div class="flex justify-around items-center py-3 relative">
            <a href="home.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Home</div>
            </a>
            <a href="signals.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Signals</div>
            </a>
            
            <!-- Floating Trade Button - Half overlapping the navigation -->
            <div class="flex-1 flex justify-center">
                <button 
                    onclick="openTradingPlatform()" 
                    class="bg-primary text-bg rounded-full w-14 h-14 shadow-xl flex items-center justify-center font-bold hover:scale-110 transition-all duration-200 -mt-7 border-4 border-bg-elevated"
                    title="Open Trading Platform"
                >
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
                        <path d="M12 5v14m7-7H5"></path>
                    </svg>
                </button>
            </div>
            
            <a href="education.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Learn</div>
            </a>
            <a href="profile.html" class="text-primary text-center flex-1">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui font-medium">Me</div>
            </a>
        </div>
    </nav>

    <script>
        // Authentication check
        function checkAuth() {
            const user = localStorage.getItem('flp_user');
            if (!user) {
                window.location.href = 'index.html';
                return false;
            }
            
            const userData = JSON.parse(user);
            if (!userData.isLoggedIn) {
                window.location.href = 'index.html';
                return false;
            }
            
            return userData;
        }

        // Toggle between view and edit mode
        function toggleEditMode(isEditing) {
            const viewMode = document.getElementById('profileViewMode');
            const editMode = document.getElementById('profileEditMode');

            if (isEditing) {
                // Switch to edit mode
                viewMode.classList.add('hidden');
                editMode.classList.remove('hidden');

                // Populate edit fields with current values
                const userData = JSON.parse(localStorage.getItem('flp_user'));
                document.getElementById('fullName').value = userData.fullName || '';
                document.getElementById('username').value = userData.username || userData.name || '';
                document.getElementById('email').value = userData.email || '';
                document.getElementById('phone').value = userData.phone || '';
            } else {
                // Switch back to view mode
                viewMode.classList.remove('hidden');
                editMode.classList.add('hidden');
            }
        }

        // Update profile with user data
        function updateProfile(userData) {
            // Update avatar with initials
            const fullName = userData.fullName || userData.name || '';
            const initials = fullName ? fullName.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
            document.getElementById('userAvatar').textContent = initials;

            // Populate view mode displays
            document.getElementById('fullNameDisplay').textContent = userData.fullName || '-';
            document.getElementById('usernameDisplay').textContent = userData.username || userData.name || '-';
            document.getElementById('emailDisplay').textContent = userData.email || '-';
            document.getElementById('phoneDisplay').textContent = userData.phone || '-';

            // Populate edit mode fields
            document.getElementById('fullName').value = userData.fullName || '';
            document.getElementById('username').value = userData.username || userData.name || '';
            document.getElementById('email').value = userData.email || '';
            document.getElementById('phone').value = userData.phone || '';
        }

        // Save profile changes
        async function saveProfile() {
            const fullName = document.getElementById('fullName').value.trim();
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            if (!fullName || !email) {
                alert('Please fill in Full Name and Email');
                return;
            }

            const saveBtn = document.getElementById('saveProfileBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const userData = JSON.parse(localStorage.getItem('flp_user'));
                const userId = userData.id || 'demo-user';

                const response = await fetch('/api/content/user/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-ID': userId
                    },
                    body: JSON.stringify({
                        fullName,
                        username,
                        email,
                        phone
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Update local storage
                    const updatedUser = {
                        ...userData,
                        fullName,
                        username,
                        email,
                        phone,
                        name: username || fullName
                    };
                    localStorage.setItem('flp_user', JSON.stringify(updatedUser));

                    // Update UI
                    updateProfile(updatedUser);

                    // Switch back to view mode
                    toggleEditMode(false);

                    alert('Profile updated successfully!');
                } else {
                    alert('Failed to update profile: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Failed to update profile. Please try again.');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Changes';
            }
        }

        // Toggle between password view and edit mode
        function togglePasswordEditMode(isEditing) {
            const viewMode = document.getElementById('passwordViewMode');
            const editMode = document.getElementById('passwordEditMode');

            if (isEditing) {
                // Switch to edit mode
                viewMode.classList.add('hidden');
                editMode.classList.remove('hidden');

                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } else {
                // Switch back to view mode
                viewMode.classList.remove('hidden');
                editMode.classList.add('hidden');

                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            const eyeOpen = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>`;
            const eyeClosed = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                <path d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 11-4.243-4.243m4.242 4.242L9.88 9.88"></path>
            </svg>`;

            button.innerHTML = type === 'password' ? eyeOpen : eyeClosed;
        }

        // Change password
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Please fill in all password fields');
                return;
            }

            if (newPassword.length < 6) {
                alert('New password must be at least 6 characters');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }

            const changeBtn = document.getElementById('changePasswordBtn');
            changeBtn.disabled = true;
            changeBtn.textContent = 'Changing...';

            try {
                const userData = JSON.parse(localStorage.getItem('flp_user'));
                const userId = userData.id || 'demo-user';

                const response = await fetch('/api/content/user/change-password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-ID': userId
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Password changed successfully!');

                    // Switch back to view mode
                    togglePasswordEditMode(false);
                } else {
                    alert('Failed to change password: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error changing password:', error);
                alert('Failed to change password. Please try again.');
            } finally {
                changeBtn.disabled = false;
                changeBtn.textContent = 'Save Password';
            }
        }

        // Global logout function for backup
        window.logout = function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
        };
        
        // Simple, direct logout function
        function performLogout() {
            console.log('Logout function called');
            
            // Show confirmation dialog
            const confirmed = confirm('Are you sure you want to logout?');
            
            if (confirmed) {
                console.log('Logout confirmed');
                
                // Clear all storage
                try {
                    localStorage.clear();
                    sessionStorage.clear();
                } catch (e) {
                    console.log('Storage clear error:', e);
                }
                
                // Show success message
                alert('Logged out successfully!');
                
                // Redirect immediately
                window.location.replace('login.html');
            }
        }

        // Initialize page and event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up logout');

            // Set up logout button
            const logoutBtn = document.getElementById('logoutButton');
            if (logoutBtn) {
                console.log('Logout button found, adding event listener');

                logoutBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    console.log('Logout button clicked');
                    performLogout();
                });

                // Also handle touch events for mobile
                logoutBtn.addEventListener('touchend', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    console.log('Logout button touched');
                    performLogout();
                });
            } else {
                console.error('Logout button not found!');
            }

            // Set up save profile button
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            if (saveProfileBtn) {
                saveProfileBtn.addEventListener('click', saveProfile);
            }

            // Set up change password button
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', changePassword);
            }

            // Check authentication
            const userData = checkAuth();
            if (userData) {
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }

                // Update profile with user data
                updateProfile(userData);
            }
        });
    </script>
</body>
</html>