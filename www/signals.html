<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0B0B0B" />
    <meta name="description" content="Your personal trading mentor, market toolkit, and daily challenge ‚Äì all in your pocket." />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>FLP AcademyWorks - Signals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/trading-platform.js?v=3"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Brand colors from design.json
                        primary: '#FFD60A',
                        success: '#32D74B',
                        warning: '#FFD60A',
                        danger: '#FF453A',
                        info: '#64D2FF',
                        
                        // Background colors
                        bg: '#0B0B0F',
                        'bg-elevated': '#141417',
                        'bg-secondary': '#1C1C1F',
                        'bg-tertiary': '#2C2C2E',
                        
                        // Text colors
                        'label-primary': '#FFFFFF',
                        'label-secondary': 'rgba(235,235,245,0.6)',
                        'label-tertiary': 'rgba(235,235,245,0.3)',
                        'label-quaternary': 'rgba(235,235,245,0.18)',
                        
                        // Fill colors
                        'fill-primary': 'rgba(120,120,128,0.36)',
                        'fill-secondary': 'rgba(120,120,128,0.32)',
                        'fill-tertiary': 'rgba(120,120,128,0.24)',
                        
                        // Interaction colors
                        separator: 'rgba(84,84,88,0.36)',
                        overlay: 'rgba(0,0,0,0.6)',
                        'focus-ring': 'rgba(255,214,10,0.45)',
                        
                        // Trading colors
                        'chart-up': '#32D74B',
                        'chart-down': '#FF453A',
                        buy: '#32D74B',
                        sell: '#FF453A'
                    },
                    fontFamily: {
                        'sf-pro': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-display': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-ui': ['SF Pro Text', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'elevated': '0 4px 16px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)',
                        'card': '0 2px 8px rgba(0,0,0,0.1)',
                        'button': '0 1px 3px rgba(0,0,0,0.12)',
                        'modal': '0 8px 32px rgba(0,0,0,0.24)'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-bg text-label-primary font-sf-ui">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-bg flex items-center justify-center z-50">
        <div class="text-center">
            <div class="text-primary text-2xl font-bold mb-4">FLP</div>
            <div class="text-white">Loading...</div>
        </div>
    </div>
    <!-- Top Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-4 py-3 flex justify-between items-center" style="background: rgba(22,22,24,0.6); backdrop-filter: blur(20px);">
        <div class="text-primary text-base font-sf-display font-semibold">FLP AcademyWorks</div>
        <a href="notifications.html" class="text-label-secondary opacity-80 hover:opacity-100 transition-opacity relative">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                <path d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"></path>
            </svg>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">3</span>
            </div>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="pt-16 pb-20 max-w-md mx-auto">
        <!-- Tabs -->
        <div class="flex bg-gray-800 mx-4 mt-4 rounded-lg p-1">
            <button class="flex-1 bg-primary text-black py-2 px-3 rounded-md text-xs font-medium tab-btn" onclick="switchTab('live')">
                Live Signals
            </button>
            <button class="flex-1 text-gray-300 py-2 px-3 rounded-md text-xs font-medium tab-btn" onclick="switchTab('history')">
                History
            </button>
        </div>

        <!-- Live Signals Tab -->
        <div id="live-tab" class="px-4 mt-4 space-y-4">
            <!-- Loading State -->
            <div id="liveLoading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <div class="text-label-secondary text-sm mt-3">Loading today's signals...</div>
            </div>

            <!-- Empty State -->
            <div id="liveEmpty" class="hidden text-center py-12">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-16 h-16 mx-auto text-label-tertiary mb-3">
                    <path d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>
                </svg>
                <div class="text-label-secondary text-sm">No signals available today</div>
                <div class="text-label-tertiary text-xs mt-1">Check back later for new trading opportunities</div>
            </div>

            <!-- Signals Container -->
            <div id="liveSignalsContainer">
                <!-- Real-time signals will be injected here by signal-client.js -->
            </div>

            <!-- Sample Signal Card (hidden by default, used as template) -->
            <div id="signalTemplate" class="hidden">
            <!-- Signal Card 1 - BUY -->
            <div class="bg-gray-900 rounded-lg p-4 border-l-4 border-green-500">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-base font-bold">EUR/USD</h3>
                            <span class="bg-green-500 text-black px-2 py-1 rounded-full text-xs font-bold">BUY</span>
                        </div>
                        <p class="text-gray-400 text-xs">üïê 2 minutes ago</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">Risk</div>
                        <div class="text-primary font-bold">2.5%</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-3 text-xs">
                    <div>
                        <div class="text-gray-400">Entry</div>
                        <div class="font-semibold">1.0850</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Stop Loss</div>
                        <div class="font-semibold text-red-400">1.0820</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Take Profit</div>
                        <div class="font-semibold text-green-400">1.0920</div>
                    </div>
                </div>

                <!-- Confidence Meter -->
                <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-400">Confidence</span>
                        <span class="text-primary font-semibold">85%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-primary h-2 rounded-full" style="width: 85%"></div>
                    </div>
                </div>

                <button class="w-full bg-gray-800 text-white py-2 px-4 rounded-lg text-xs font-medium">
                    <span class="flex items-center gap-2">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                            <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                        </svg>
                        Explain this Signal
                    </span>
                </button>
            </div>

            <!-- Signal Card 2 - SELL -->
            <div class="bg-gray-900 rounded-lg p-4 border-l-4 border-red-500">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-base font-bold">GBP/JPY</h3>
                            <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold">SELL</span>
                        </div>
                        <p class="text-gray-400 text-xs">üïê 5 minutes ago</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">Risk</div>
                        <div class="text-primary font-bold">1.8%</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-3 text-xs">
                    <div>
                        <div class="text-gray-400">Entry</div>
                        <div class="font-semibold">185.20</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Stop Loss</div>
                        <div class="font-semibold text-red-400">186.50</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Take Profit</div>
                        <div class="font-semibold text-green-400">183.80</div>
                    </div>
                </div>

                <!-- Confidence Meter -->
                <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-400">Confidence</span>
                        <span class="text-primary font-semibold">72%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-primary h-2 rounded-full" style="width: 72%"></div>
                    </div>
                </div>

                <button class="w-full bg-gray-800 text-white py-2 px-4 rounded-lg text-xs font-medium">
                    <span class="flex items-center gap-2">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                            <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                        </svg>
                        Explain this Signal
                    </span>
                </button>
            </div>

            <!-- Signal Card 3 - BUY -->
            <div class="bg-gray-900 rounded-lg p-4 border-l-4 border-green-500">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-base font-bold">USD/CAD</h3>
                            <span class="bg-green-500 text-black px-2 py-1 rounded-full text-xs font-bold">BUY</span>
                        </div>
                        <p class="text-gray-400 text-xs">üïê 12 minutes ago</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">Risk</div>
                        <div class="text-primary font-bold">3.0%</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-3 text-xs">
                    <div>
                        <div class="text-gray-400">Entry</div>
                        <div class="font-semibold">1.3420</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Stop Loss</div>
                        <div class="font-semibold text-red-400">1.3380</div>
                    </div>
                    <div>
                        <div class="text-gray-400">Take Profit</div>
                        <div class="font-semibold text-green-400">1.3520</div>
                    </div>
                </div>

                <!-- Confidence Meter -->
                <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-400">Confidence</span>
                        <span class="text-primary font-semibold">91%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-primary h-2 rounded-full" style="width: 91%"></div>
                    </div>
                </div>

                <button class="w-full bg-gray-800 text-white py-2 px-4 rounded-lg text-xs font-medium">
                    <span class="flex items-center gap-2">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                            <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                        </svg>
                        Explain this Signal
                    </span>
                </button>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="px-4 mt-4 hidden">
            <!-- Date Filter -->
            <div class="bg-bg-elevated rounded-lg p-4 mb-4">
                <label class="text-xs text-label-secondary mb-2 block">Filter by Date</label>
                <div class="flex gap-2">
                    <input
                        type="date"
                        id="historyStartDate"
                        class="flex-1 bg-bg-secondary text-label-primary px-3 py-2 rounded-lg text-xs border border-separator focus:border-primary focus:outline-none"
                    >
                    <span class="text-label-secondary self-center">to</span>
                    <input
                        type="date"
                        id="historyEndDate"
                        class="flex-1 bg-bg-secondary text-label-primary px-3 py-2 rounded-lg text-xs border border-separator focus:border-primary focus:outline-none"
                    >
                </div>
                <button onclick="filterHistory()" class="w-full mt-3 bg-primary text-bg py-2 rounded-lg text-xs font-medium">
                    Apply Filter
                </button>
            </div>

            <!-- Loading State -->
            <div id="historyLoading" class="hidden text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <div class="text-label-secondary text-sm mt-3">Loading history...</div>
            </div>

            <!-- Empty State -->
            <div id="historyEmpty" class="hidden text-center py-12">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-16 h-16 mx-auto text-label-tertiary mb-3">
                    <path d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="text-label-secondary text-sm">No signals found</div>
                <div class="text-label-tertiary text-xs mt-1">Try adjusting your date filter</div>
            </div>

            <!-- History Container -->
            <div id="historyContainer" class="space-y-4">
                <!-- Historical signals will be loaded here -->
            </div>
        </div>
    </main>

    <!-- iOS-style Tab Bar -->
    <nav class="fixed bottom-0 left-0 right-0 z-40 border-t border-separator/50" style="background: rgba(22,22,24,0.75); backdrop-filter: blur(30px);">
        <div class="flex justify-around items-center py-3 relative">
            <a href="home.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Home</div>
            </a>
            <a href="signals.html" class="text-primary text-center flex-1">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui font-medium">Signals</div>
            </a>
            
            <!-- Floating Trade Button - Half overlapping the navigation -->
            <div class="flex-1 flex justify-center">
                <button 
                    onclick="openTradingPlatform()" 
                    class="bg-primary text-bg rounded-full w-14 h-14 shadow-xl flex items-center justify-center font-bold hover:scale-110 transition-all duration-200 -mt-7 border-4 border-bg-elevated"
                    title="Open Trading Platform"
                >
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
                        <path d="M12 5v14m7-7H5"></path>
                    </svg>
                </button>
            </div>
            
            <a href="education.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Learn</div>
            </a>
            <a href="profile.html" class="text-label-secondary text-center flex-1 opacity-70">
                <div class="flex justify-center mb-1">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                        <path d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <div class="text-xs font-sf-ui">Me</div>
            </a>
        </div>
    </nav>

    <script>
        let allSignals = [];

        function switchTab(tabName) {
            // Hide all tabs
            document.getElementById('live-tab').classList.add('hidden');
            document.getElementById('history-tab').classList.add('hidden');

            // Remove active styling from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-black');
                btn.classList.add('text-gray-300');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');

            // Add active styling to selected button
            event.target.classList.add('bg-primary', 'text-black');
            event.target.classList.remove('text-gray-300');

            // Load data for the selected tab
            if (tabName === 'history') {
                loadHistorySignals();
            }
        }

        async function loadHistorySignals(startDate = null, endDate = null) {
            const container = document.getElementById('historyContainer');
            const loading = document.getElementById('historyLoading');
            const empty = document.getElementById('historyEmpty');

            loading.classList.remove('hidden');
            container.innerHTML = '';
            empty.classList.add('hidden');

            try {
                let url = '/api/signals/history';
                const params = new URLSearchParams();

                if (startDate) params.append('start', startDate);
                if (endDate) params.append('end', endDate);

                if (params.toString()) {
                    url += '?' + params.toString();
                }

                const response = await fetch(url);
                const data = await response.json();

                loading.classList.add('hidden');

                if (data.success && data.signals && data.signals.length > 0) {
                    data.signals.forEach(signal => {
                        container.appendChild(createHistorySignalCard(signal));
                    });
                } else {
                    empty.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading history:', error);
                loading.classList.add('hidden');
                empty.classList.remove('hidden');
            }
        }

        function filterHistory() {
            const startDate = document.getElementById('historyStartDate').value;
            const endDate = document.getElementById('historyEndDate').value;
            loadHistorySignals(startDate, endDate);
        }

        function createHistorySignalCard(signal) {
            const isWin = signal.status === 'TP_HIT' || signal.profit > 0;
            const borderColor = isWin ? 'border-green-600' : 'border-red-600';
            const statusBg = isWin ? 'bg-green-600' : 'bg-red-600';
            const statusText = isWin ? 'WIN' : signal.status === 'SL_HIT' ? 'LOSS' : 'CLOSED';
            const profitColor = isWin ? 'text-green-400' : 'text-red-400';
            const profitSign = signal.profit > 0 ? '+' : '';

            const card = document.createElement('div');
            card.className = `bg-gray-900 rounded-lg p-4 border-l-4 ${borderColor}`;
            card.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <div>
                        <h3 class="text-base font-bold">${signal.pair}</h3>
                        <p class="text-gray-400 text-xs">${formatDate(signal.created_at)}</p>
                    </div>
                    <div class="text-right">
                        <span class="${statusBg} text-white px-2 py-1 rounded-full text-xs">${statusText}</span>
                        ${signal.profit !== undefined ? `<div class="${profitColor} font-bold">${profitSign}${signal.profit.toFixed(1)}%</div>` : ''}
                    </div>
                </div>
                <div class="text-xs text-gray-400">
                    Entry: ${signal.entry} ${signal.exit_price ? `‚Üí Exit: ${signal.exit_price}` : ''}
                </div>
            `;
            return card;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return 'Today';
            if (days === 1) return 'Yesterday';
            if (days < 7) return `${days} days ago`;
            return date.toLocaleDateString();
        }

        // Set default date range (last 30 days)
        window.addEventListener('DOMContentLoaded', function() {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);

            document.getElementById('historyEndDate').valueAsDate = endDate;
            document.getElementById('historyStartDate').valueAsDate = startDate;
        });
    </script>

    <script>
        // Authentication check
        function checkAuth() {
            const user = localStorage.getItem('flp_user');
            if (!user) {
                window.location.href = 'index.html';
                return false;
            }
            
            const userData = JSON.parse(user);
            if (!userData.isLoggedIn) {
                window.location.href = 'index.html';
                return false;
            }
            
            return userData;
        }

        // Check Pro membership
        async function checkProMembership() {
            try {
                const response = await fetch('/api/settings/membership/check', {
                    headers: {
                        'Authorization': `User ${getUserId()}`
                    }
                });
                const data = await response.json();
                return data.isPro;
            } catch (error) {
                console.error('Error checking membership:', error);
                return false;
            }
        }

        function getUserId() {
            const userData = localStorage.getItem('flp_user');
            if (userData) {
                const user = JSON.parse(userData);
                return user.id || user.email || `user_${user.name}`;
            }
            let anonId = localStorage.getItem('flp_anon_id');
            if (!anonId) {
                anonId = `anon_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('flp_anon_id', anonId);
            }
            return anonId;
        }

        async function showUpgradeModal() {
            // Get Telegram link from backend
            let telegramLink = 'https://t.me/yourusername';
            try {
                const response = await fetch('/api/settings/config/telegram_upgrade_link');
                const data = await response.json();
                if (data.success && data.value) {
                    telegramLink = data.value;
                }
            } catch (error) {
                console.error('Error fetching Telegram link:', error);
            }

            const modal = document.createElement('div');
            modal.id = 'upgradeModal';
            modal.className = 'fixed inset-0 bg-overlay flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-bg-elevated rounded-2xl p-8 w-full max-w-sm shadow-elevated border border-primary/20 text-center">
                    <div class="w-20 h-20 bg-primary/20 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <svg viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-primary">
                            <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-sf-display font-semibold mb-2">Upgrade to Pro</h3>
                    <p class="text-label-secondary text-sm mb-6">
                        Access premium trading signals and exclusive content. Upgrade to Pro membership to unlock all features.
                    </p>
                    <a href="${telegramLink}" target="_blank" class="w-full block bg-primary text-bg py-3.5 rounded-lg font-sf-ui font-semibold mb-3 hover:bg-primary/90 transition-all">
                        Contact on Telegram
                    </a>
                    <button onclick="closeUpgradeModal()" class="w-full bg-bg-secondary text-label-secondary py-3 rounded-lg font-sf-ui font-medium hover:bg-fill-secondary transition-all">
                        Maybe Later
                    </button>
                </div>
            `;

            document.body.appendChild(modal);

            window.closeUpgradeModal = function() {
                const modalEl = document.getElementById('upgradeModal');
                if (modalEl) {
                    modalEl.remove();
                }
                // Redirect to home page
                window.location.href = 'home.html';
            };

            // Close on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeUpgradeModal();
                }
            });
        }

        // Initialize page
        window.addEventListener('DOMContentLoaded', async function() {
            const userData = checkAuth();
            if (userData) {
                // Check Pro membership
                const isPro = await checkProMembership();

                if (!isPro) {
                    // Show upgrade modal for non-pro users
                    document.getElementById('loadingScreen').style.display = 'none';
                    showUpgradeModal();
                } else {
                    // Hide loading screen
                    document.getElementById('loadingScreen').style.display = 'none';

                    // Initialize signal client if available
                    if (typeof SignalClient !== 'undefined') {
                        window.signalClient = new SignalClient();
                        window.signalClient.connect();
                    }
                }
            }
        });
    </script>

    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Signal Client -->
    <script src="assets/js/signal-client.js"></script>
</body>
</html>