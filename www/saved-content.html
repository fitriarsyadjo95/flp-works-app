<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0B0B0B" />
    <meta name="description" content="Your personal trading mentor, market toolkit, and daily challenge â€“ all in your pocket." />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>FLP AcademyWorks - Saved Content</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Brand colors from design.json
                        primary: '#FFD60A',
                        success: '#32D74B',
                        warning: '#FFD60A',
                        danger: '#FF453A',
                        info: '#64D2FF',
                        
                        // Background colors
                        bg: '#0B0B0F',
                        'bg-elevated': '#141417',
                        'bg-secondary': '#1C1C1F',
                        'bg-tertiary': '#2C2C2E',
                        
                        // Text colors
                        'label-primary': '#FFFFFF',
                        'label-secondary': 'rgba(235,235,245,0.6)',
                        'label-tertiary': 'rgba(235,235,245,0.3)',
                        'label-quaternary': 'rgba(235,235,245,0.18)',
                        
                        // Fill colors
                        'fill-primary': 'rgba(120,120,128,0.36)',
                        'fill-secondary': 'rgba(120,120,128,0.32)',
                        'fill-tertiary': 'rgba(120,120,128,0.24)',
                        
                        // Interaction colors
                        separator: 'rgba(84,84,88,0.36)',
                        overlay: 'rgba(0,0,0,0.6)',
                        'focus-ring': 'rgba(255,214,10,0.45)',
                        
                        // Trading colors
                        'chart-up': '#32D74B',
                        'chart-down': '#FF453A',
                        buy: '#32D74B',
                        sell: '#FF453A'
                    },
                    fontFamily: {
                        'sf-pro': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-display': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                        'sf-ui': ['SF Pro Text', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'elevated': '0 4px 16px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)',
                        'card': '0 2px 8px rgba(0,0,0,0.1)',
                        'button': '0 1px 3px rgba(0,0,0,0.12)',
                        'modal': '0 8px 32px rgba(0,0,0,0.24)'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-bg text-label-primary font-sf-ui">
    <!-- Top Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-4 py-3 flex justify-between items-center" style="background: rgba(22,22,24,0.6); backdrop-filter: blur(20px);">
        <div class="flex items-center gap-3">
            <a href="home.html" class="text-label-secondary opacity-80 hover:opacity-100 transition-opacity">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                    <path d="M19 12H5m7 7l-7-7 7-7"></path>
                </svg>
            </a>
            <div class="text-primary text-base font-sf-display font-semibold">Saved Content</div>
        </div>
        <button class="text-label-secondary opacity-80 hover:opacity-100 transition-opacity">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="19" cy="12" r="1"></circle>
                <circle cx="5" cy="12" r="1"></circle>
            </svg>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-24 max-w-md mx-auto px-4">
        <!-- Stats -->
        <div class="bg-bg-elevated rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-center gap-12">
                <div class="text-center">
                    <div class="text-3xl font-sf-display font-bold text-primary" data-videos-count>0</div>
                    <div class="text-xs text-label-secondary mt-1">Videos Saved</div>
                </div>
            </div>
        </div>

        <!-- Saved Items -->
        <div class="space-y-4" id="savedContent">
            <!-- Loading state -->
            <div class="text-center py-12">
                <div class="text-label-secondary">Loading saved videos...</div>
            </div>
        </div>
    </main>

    <script>
        // Check authentication
        function checkAuth() {
            const user = localStorage.getItem('flp_user');
            if (!user) {
                window.location.href = 'index.html';
                return null;
            }

            const userData = JSON.parse(user);
            if (!userData.isLoggedIn) {
                window.location.href = 'index.html';
                return null;
            }

            return userData;
        }

        // Format duration from seconds to MM:SS
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Format view count
        function formatViews(views) {
            if (views >= 1000000) {
                return (views / 1000000).toFixed(1) + 'M';
            } else if (views >= 1000) {
                return (views / 1000).toFixed(1) + 'K';
            }
            return views.toString();
        }

        // Format saved date
        function formatSavedDate(savedAt) {
            const saved = new Date(savedAt);
            const now = new Date();
            const diffMs = now - saved;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return `${Math.floor(diffDays / 30)} months ago`;
        }

        // Load saved content from backend
        async function loadSavedContent() {
            try {
                const userData = checkAuth();
                if (!userData) return;

                const response = await fetch('/api/content/user/saved', {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-ID': userData.id || 'demo-user'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const courses = data.courses || [];

                    // Update stats
                    document.querySelector('[data-videos-count]').textContent = courses.length;

                    // Render courses
                    renderSavedCourses(courses);
                } else {
                    console.error('Failed to load saved content:', data.error);
                    renderEmptyState();
                }
            } catch (error) {
                console.error('Error loading saved content:', error);
                renderEmptyState();
            }
        }

        // Render saved courses
        function renderSavedCourses(courses) {
            const container = document.getElementById('savedContent');

            if (courses.length === 0) {
                renderEmptyState();
                return;
            }

            container.innerHTML = courses.map(course => `
                <div class="bg-bg-elevated rounded-2xl overflow-hidden saved-item" data-course-id="${course.id}">
                    <div class="relative">
                        <div class="h-48 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center" style="${course.thumbnail_url ? `background-image: url(${course.thumbnail_url}); background-size: cover; background-position: center;` : ''}">
                            ${!course.thumbnail_url ? `
                            <div class="w-12 h-12 flex items-center justify-center">
                                <svg viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-white">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                            </div>
                            ` : ''}
                        </div>
                        <div class="absolute top-3 right-3">
                            <button onclick="removeSavedCourse('${course.id}')" class="bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors">
                                <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="text-base font-sf-ui font-semibold text-label-primary mb-2">${course.title || 'Untitled Video'}</h3>
                        <div class="flex items-center justify-between text-xs text-label-tertiary mb-3 font-sf-ui">
                            <span class="flex items-center gap-1">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                                    <path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                ${formatViews(course.views || 0)} views
                            </span>
                            <span class="flex items-center gap-1">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12,6 12,12 16,14"></polyline>
                                </svg>
                                ${formatDuration(course.duration_seconds || 0)}
                            </span>
                        </div>
                        <div class="text-xs text-label-secondary">Saved ${formatSavedDate(course.saved_at)}</div>
                    </div>
                </div>
            `).join('');
        }

        // Render empty state
        function renderEmptyState() {
            const container = document.getElementById('savedContent');
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-16 h-16 mx-auto mb-4 bg-bg-elevated rounded-full flex items-center justify-center">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-8 h-8 text-label-tertiary">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-label-primary mb-2">No Saved Videos</h3>
                    <p class="text-sm text-label-secondary mb-6">Videos you save will appear here</p>
                    <a href="education.html" class="inline-block bg-primary text-bg px-6 py-2 rounded-lg text-sm font-medium">
                        Browse Videos
                    </a>
                </div>
            `;
        }

        // Remove saved course
        async function removeSavedCourse(courseId) {
            try {
                const userData = checkAuth();
                if (!userData) return;

                const response = await fetch(`/api/content/user/saved/${courseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-ID': userData.id || 'demo-user'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Reload saved content
                    loadSavedContent();
                } else {
                    alert('Failed to remove video: ' + data.error);
                }
            } catch (error) {
                console.error('Error removing saved course:', error);
                alert('Failed to remove video');
            }
        }

        function goBack() {
            // Check if there's history to go back to
            if (window.history.length > 1 && document.referrer) {
                window.history.back();
            } else {
                // Default to home page if no history
                window.location.href = 'home.html';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedContent();
        });
    </script>
</body>
</html>